(()=>{["POST","PUT","GET","DELETE"].forEach((t=>{var e;Vue.prototype["$fetch"+(e=t,e.charAt(0).toUpperCase()+e.slice(1).toLowerCase())]=function(e,o){return function(t,e,o,n){t.loading=!0;let i={method:e,headers:{"Content-Type":"application/json"}};return"POST"!==e&&"PUT"!==e||(i.body=JSON.stringify(n)),fetch("/api"+o,i).then((t=>t.json())).then((function(e){if(t.loading=!1,e.error)throw e.error;return e})).catch((function(e){t.loading=!1,t.error=e,t.$forceUpdate()}))}(this,t,e,o)}}));const t=function(t,e){var o="/favorites/"+e.id,n=e.$isFavorite;t[n?"$fetchDelete":"$fetchPost"](o,{}).then((function(o){e.$isFavorite=!n,t.$forceUpdate()}))};Vue.component("locations",{template:"#locations",data:function(){return{adding:!1,locations:[],locationSearchText:""}},methods:{isFavorite:function(t){return t.filter((t=>t.$isFavorite))},matchesSearchText:function(t){return!this.locationSearchText.length||t.name.toLowerCase().includes(this.locationSearchText.toLowerCase())},toggleFavorite:function(e){t(this,e)}},created:function(){var t=this;this.$fetchGet("/locations").then((function(e){t.locations=e.locations}))}}),Vue.component("add-location",{template:"#add-location",data:function(){return{req:{},error:"",loading:!1}},methods:{invalid:function(){return!this.req.name},submit:function(){this.$fetchPost("/locations",this.req).then((t=>this.$goTo("/locations/"+t.locationId)))}}});const e={NNW:[337.5,360],NNE:[0,22.5],NE:[22.5,67.5],E:[67.5,112.5],SE:[112.5,157.5],S:[157.5,202.5],SW:[202.5,247.5],W:[247.5,292.5],NW:[292.5,337.5]},o=function(t){return"MM"===t?"MM":(3.28084*parseFloat(t)).toFixed(1)},n=function(t){return"MM"===t?"MM":(2.23694*parseFloat(t)).toFixed(1)},i=function(t,e,o,n,i){return Vue.prototype.$moment(t+"-"+e+"-"+o+"T"+n+":"+i+":00Z")},a=function(t){return"MM"===t?"MM":parseFloat(t).toFixed(1)},s=function(t){return 360==t||0==t?"N":Object.keys(e).find((o=>{const n=e[o];return t>=n[0]&&t<n[1]}))},r=function(t){var e={};return e.time=i(t[0],t[1],t[2],t[3],t[4]),e.windDirection=t[5],e.windDirectionAbbr=s(e.windDirection),e.windSpeed=n(t[6]),e.gust=n(t[7]),e.waveHeight=o(t[8]),e.wavePeriod=a(t[9]),e.waveDirection=t[11],e.waveDirectionAbbr=s(e.waveDirection),e},u=function(t){var e={};return e.time=i(t[0],t[1],t[2],t[3],t[4]),e.waveHeight=o(t[5]),e.swellHeight=o(t[6]),e.swellPeriod=a(t[7]),e.meanWaveDirection=parseInt(t[14]),e.swellDirection=t[10],e.windWaveSummary=o(t[8])+" / "+a(t[9]),e.windWaveDirection=t[11],e},h=function(t,e){return t&&t.length?("#YY"===t[0][0]&&"#yr"===t[1][0]&&(t=t.slice(2)),t.map("wave"===e?u:r)):[]};Vue.component("buoy-data",{template:"#buoy-data",props:["buoy","type","location"],data:function(){return{tables:[]}},methods:{load:function(){let t=24*this.tables.length,e="/buoys/"+this.buoy.buoyid+"/data?type="+this.type+"&offset="+t,o=this;this.$fetchGet(e).then((function(t){t.data&&o.tables.push({rows:h(t.data,o.type)})}))},formatDate:function(t){return(t=t.clone()).tz(this.location&&this.location.timezone||"UTC").format("M/D h:mm a")}},created:function(){this.load()}});var c=function(t){return t.waveheight=o(t.waveheight),t.swellheight=o(t.swellheight),t.swellperiod=a(t.swellperiod),t.windWaveSummary=o(t.windwaveheight)+" / "+a(t.windwaveperiod),t},l=function(t){return t.$waveHeight=t.waveheight?p[t.waveheight]:"",t.$qualityText=t.quality?f[t.quality]:"",t.$imagePath=t.imagepath,t.$imagePath&&!t.$imagePath.startsWith("http")?t.$imagePath="https://www.buoyreport.com/uploads/"+t.imagepath:t.$imagePath&&(t.$imagePath=t.$imagePath.replace("/image/upload/","/image/upload/c_scale,w_680/")),t.$buoyData=t.buoyData.map(c),t.$by=t.email?t.email.split("@")[0]:0,t};const p={1.5:"1-2'",2.5:"2-3'",3.5:"3-4'",5:"4-6'",7:"6-8'",9:"8-10'",11:"10-12'",13.5:"12-15'",17.5:"15-20'",25:"20-30'"};let d=Object.keys(p).sort(((t,e)=>parseFloat(t)-parseFloat(e)));d.unshift(null);var f={1:"Terrible",2:"Mediocre",3:"OK",4:"Fun",5:"Great"};let m=function(t,e,o){t.loading=!0;var n=new FormData;n.append("file",e),n.append("upload_preset","production"===Vue.$nodeEnv?"buoyreport":"buoyreport_dev"),n.append("folder","production"===Vue.$nodeEnv?"buoyreport":"buoyreport_dev");var i=new XMLHttpRequest;i.onload=function(){t.loading=!1;var e=JSON.parse(i.responseText);e.secure_url?o(e.secure_url):(t.error="Error uploading image",console.warn(e),t.$forceUpdate())},i.open("post","https://api.cloudinary.com/v1_1/duq2wnb9p/image/upload"),i.send(n)};Vue.component("add-snapshot",{template:"#add-snapshot",props:["location","snapshots"],data:function(){return{req:{hourOffset:0},error:"",loading:!1,hourOffsetRange:Array.from(Array(240).keys()),QUALITIES_KEYS:Object.keys(f),QUALITIES:f,WAVE_HEIGHTS_KEYS:d,WAVE_HEIGHTS:p}},methods:{hourOffsetStr:function(t){return 0===t?"Now":t+(t>1?" hours ago":" hour ago")},clearImage:function(){this.req.imagepath=""},imageSelected:function(t){var e=t.target.files[0];this.req.imagepath=e},submit:function(){this.req.imagepath?m(this,this.req.imagepath,this.postSnapshot):this.postSnapshot()},postSnapshot:function(t){this.req.imagepath=t||"";let e=this;this.$fetchPost("/locations/"+this.location.id+"/snapshots",this.req).then((function(t){e.snapshots.unshift(l(t.snapshot))}))}}}),Vue.component("snapshots",{template:"#snapshots",props:["location"],data:function(){return{page:0,isLastPage:!1,snapshots:[]}},created:function(){this.load()},methods:{load:function(){let t=this.location?"/locations/"+this.location.id+"/snapshots":"/snapshots",e=this;this.$fetchGet(t+"?page="+(this.page+1)).then((function(t){let o=t.snapshots.rows;o.forEach((function(t){e.snapshots.push(l(t))})),e.page+=1,e.isLastPage=o.length<10}))}}}),Vue.component("snapshot",{template:"#snapshot",props:["snapshot","snapshots"],data:function(){return{isUpdating:!1,loading:!1}},methods:{deleteSnapshot:function(){if(window.confirm("Are you sure you want to delete this snapshot?")){var t=this;this.$fetchDelete("/snapshots/"+this.snapshot.id).then((function(){t.snapshots.splice(t.snapshots.indexOf(t.snapshot),1)}))}}}}),Vue.component("update-snapshot",{template:"#update-snapshot",props:["snapshot"],data:function(){return{req:(({quality:t,waveheight:e,text:o,imagepath:n})=>({quality:t,waveheight:e,text:o,imagepath:n}))(this.snapshot),error:"",loading:!1,QUALITIES_KEYS:Object.keys(f),QUALITIES:f,WAVE_HEIGHTS_KEYS:d,WAVE_HEIGHTS:p}},methods:{clearImage:function(){this.req.imagepath=""},imageSelected:function(t){var e=t.target.files[0];this.req.imagepath=e},submit:function(){this.req.imagepath?m(this,this.req.imagepath,this.updateSnapshot):this.updateSnapshot()},updateSnapshot:function(t){this.req.imagepath=t||"";var e=this;this.$fetchPut("/snapshots/"+this.snapshot.id,this.req).then((function(t){Object.assign(e.snapshot,l(t.snapshot)),e.$emit("update-snapshot:close")}))}}}),Vue.component("my-snapshots",{template:"#my-snapshots"}),Vue.component("location",{template:"#location",data:function(){let t=window.location.pathname.match(/([\d]+)/g);return{locationId:t?parseInt(t[0]):null,location:null,buoys:[],loading:!1}},methods:{screenWidth:function(){return window.screen.width}},created:function(){var t=this;this.locationId&&(this.$fetchGet("/locations/"+this.locationId).then((function(e){t.location=e.location,t.$root.$emit("location:location",t.location)})),this.$fetchGet("/locations/"+this.locationId+"/buoys").then((t=>this.buoys=t.buoys)))},destroyed:function(){this.$root.$emit("location:location",null)}}),Vue.component("update-location",{template:"#update-location",props:["location","buoys","snapshots"],data:function(){return{req:Object.assign({},this.location),error:"",loading:!1}},watch:{buoys:function(t){this.req.buoys=this.buoys.map((t=>t.buoyid)).join(", "),this.$forceUpdate()}},methods:{invalid:function(){return!this.req.name},submit:function(){this.$fetchPut("/locations/"+this.location.id,this.req).then((function(t){return window.location.reload()}))},deleteLocation:function(){window.confirm("Are you sure you want to delete this location?")&&this.$fetchDelete("/locations/"+this.location.id).then((()=>this.$goTo("/")))}}}),Vue.component("buoys",{template:"#buoys",data:function(){return{adding:!1,buoys:[]}},created:function(){this.$fetchGet("/buoys").then((t=>this.buoys=t.buoys))}}),Vue.component("add-buoy",{template:"#add-buoy",data:function(){return{req:{},error:"",loading:!1}},methods:{invalid:function(){return!this.req.buoyid},submit:function(){this.$fetchPost("/buoys",this.req).then((function(t){window.location.href="/buoys/"+t.buoy.buoyid}))}}}),Vue.component("buoy",{template:"#buoy",data:function(){let t=window.location.pathname.match(/buoys\/([\d]+)/g);return t=t?t[0].split("/")[1]:null,{buoyId:t,buoy:null}},created:function(){var t=this;this.$fetchGet("/buoys/"+this.buoyId).then((function(e){t.buoy=e.buoy,t.$root.$emit("buoy:buoy",t.buoy),t.$forceUpdate()}),(function(){t.$root.$emit("buoy:buoy",null)}))},destroyed:function(){this.$root.$emit("buoy:buoy",null)}}),Vue.component("update-buoy",{template:"#update-buoy",props:["buoy"],data:function(){return{name:this.buoy.name,error:"",loading:!1}},methods:{invalid:function(){return!this.name},submit:function(){let t=this;this.$fetchPut("/buoys/"+this.buoy.buoyid,{name:this.name}).then((function(e){t.buoy.name=t.name,t.$forceUpdate()}))},deleteBuoy:function(){window.confirm("Are you sure you want to delete buoy #"+this.buoy.buoyid+"?")&&this.$fetchDelete("/buoys/"+this.buoy.buoyid).then((()=>this.$goTo("/buoys")))}}}),Vue.component("about",{template:"#about"}),new Vue({el:"#app",data:{currentPath:window.location.pathname,isMenuOpen:!1,buoy:null,location:null},mounted:function(){let t=this;var e=window.history.pushState;window.history.pushState=function(t){return window.onpushstate({state:t}),e.apply(history,arguments)},window.onpopstate=window.onpushstate=function(e){console.log("state change",e.state),t.currentPath=e.state?e.state.path:"/",window.scrollTo(0,0),t.isMenuOpen=!1,t.$forceUpdate()},Vue.prototype.$goTo=function(t){window.history.pushState({path:t},"",t)},window.addEventListener("click",(t=>{let{target:e}=t;for(;e&&"A"!==e.tagName;)e=e.parentNode;if(e&&e.matches("a:not([href*='://'])")&&e.href){const{altKey:o,ctrlKey:n,metaKey:i,shiftKey:a,button:s,defaultPrevented:r}=t;if(i||o||n||a||r||void 0!==s&&0!==s)return;if(e.href.match("/login|/logout"))return;if(e.getAttribute){const t=e.getAttribute("target");if(/\b_blank\b/i.test(t))return}const u=new URL(e.href).pathname;window.location.pathname!==u&&t.preventDefault&&(t.preventDefault(),window.history.pushState({path:u},"",u))}})),t.$on("buoy:buoy",(t=>this.buoy=t)),t.$on("location:location",(t=>this.location=t))},methods:{toggleFavorite:function(e){t(this,e)},scrollTo:function(t){document.getElementById(t).scrollIntoView()}}})})();